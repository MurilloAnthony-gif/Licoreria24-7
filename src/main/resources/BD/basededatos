select * from usuarios;
-- Contrase√±a es 'admin123' 
INSERT INTO usuarios (nombre, correo, contrasena, rol)
VALUES ('Administrador Principal', 'admin@licoreria.com', '$2a$10$8.gSrhKx9.gH3mILreg.4uW.ht1nNfW2lK3.tW2q.jY.GOjKLNqS2', 'Administrador');
SHOW port;

UPDATE usuarios
SET contrasena = '$2a$10$qSIC/aC4IQsAg8KuEWz3EO.A5uOa.u9Bdfbm7nTcWDJQHPqVC3p.i'
WHERE correo = 'admin@licoreria.com';

CREATE TABLE usuarios (
    id_usuario SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    correo VARCHAR(100) NOT NULL UNIQUE,
    contrasena VARCHAR(255) NOT NULL, -- Hash de Bcrypt
    rol VARCHAR(20) NOT NULL CHECK (rol IN ('Administrador', 'Empleado'))
);

CREATE TABLE proveedores (
    id_proveedor_pk SERIAL PRIMARY KEY,
    nombre VARCHAR(150) NOT NULL,
    ruc VARCHAR(20) UNIQUE,
    telefono VARCHAR(20),
    direccion TEXT,
    correo VARCHAR(100)
);

CREATE TABLE productos (
    id_producto_pk SERIAL PRIMARY KEY,
    id_proveedor_fk INT,
    nombre VARCHAR(150) NOT NULL,
    precio NUMERIC(10, 2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    CONSTRAINT fk_proveedor_producto
        FOREIGN KEY(id_proveedor_fk) 
        REFERENCES proveedores(id_proveedor_pk)
);

CREATE TABLE compras (
    id_compra_pk SERIAL PRIMARY KEY,
    id_proveedor_fk INT NOT NULL,
    fecha TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_proveedor_compra
        FOREIGN KEY(id_proveedor_fk) 
        REFERENCES proveedores(id_proveedor_pk)
);

CREATE TABLE detalle_compras (
    id_detalle_compra_pk SERIAL PRIMARY KEY,
    id_compra_fk INT NOT NULL,
    id_producto_fk INT NOT NULL,
    cantidad INT NOT NULL,
    precio_unitario NUMERIC(10, 2) NOT NULL,
    CONSTRAINT fk_compra_detalle
        FOREIGN KEY(id_compra_fk) 
        REFERENCES compras(id_compra_pk)
        ON DELETE CASCADE,
    CONSTRAINT fk_producto_detalle
        FOREIGN KEY(id_producto_fk) 
        REFERENCES productos(id_producto_pk)
);


CREATE TABLE clientes (
    id_cliente_pk SERIAL PRIMARY KEY,
    nombre VARCHAR(150),
    cedula VARCHAR(20),
    telefono VARCHAR(20),
    direccion TEXT,
    correo VARCHAR(100)
);

CREATE TABLE ventas (
    id_venta_pk SERIAL PRIMARY KEY,
    id_cliente_fk INT,
    fecha TIMESTAMP,
    total DOUBLE PRECISION,
    CONSTRAINT fk_cliente_venta
        FOREIGN KEY(id_cliente_fk) 
        REFERENCES clientes(id_cliente_pk)
);

CREATE TABLE detalle_ventas (
    id_detalle_pk SERIAL PRIMARY KEY,
    id_venta_fk INT,
    id_producto_fk INT, -- Asumiendo que producto tiene ID tipo INT o SERIAL
    cantidad INT,
    precio DOUBLE PRECISION,
    CONSTRAINT fk_venta_detalle
        FOREIGN KEY(id_venta_fk) 
        REFERENCES ventas(id_venta_pk)
        ON DELETE CASCADE,
    CONSTRAINT fk_producto_detalle
        FOREIGN KEY(id_producto_fk) 
        REFERENCES productos(id_producto_pk)
);

CREATE TABLE pagos (
    id_pago_pk SERIAL PRIMARY KEY,
    id_venta_fk INT,
    metodo_pago VARCHAR(50),
    CONSTRAINT fk_venta_pago
        FOREIGN KEY(id_venta_fk) 
        REFERENCES ventas(id_venta_pk)
);

select * from productos;
select * from usuarios;
select * from compras;
select * from detalle_compras;
select * from proveedores;
select *from detalle_ventas;
select * from ventas;
select * from clientes;
select * from pagos;